<%- include("header"); -%>
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="./assets/js/shoppingCart.js"></script>
<div class="page-body">
    <!-- Container-fluid starts-->
    <div class="container-fluid p-t-45">
        <div class="row">
            <% if (error.length !== 0) { %>
                <div class="alert alert-danger alert-dismissible fade show" role="alert" style="text-align: right;">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <strong>پلتفرم تیارا :</strong> <%= error %>
                  </div>
            <% } %>
            <div class="col-sm-12">
                <div class="card" style="background-color: rgb(234, 235, 238);">
                    <div class="card-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div id="show-cart" class="card-deck col-xl-12 col-md-12 col-sm-12">
                                </div>
                                <div class='card shadow-lg' style='width: 100%; height: 100%; margin: 15px;'>
                                    <p class="col-xl-12 col-md-12 col-sm-12">شما <span id="count-cart">0</span> محصول در سبدتان دارید</p>
                                    <p class="col-xl-12 col-md-12 col-sm-12">مجموع قیمت: <span id="total-cart"></span> تومان</p>
                                    <div style="display:flex; justify-content: space-between; margin-bottom: 12px;">
                                        <button style="margin-left: 2px;" class="btn btn-solid w-50 col-lg-4" id="clear-cart">خالی کردن سبد</button>
                                        <form method="GET" class="w-50" action="/customerInfo">
                                            <button type="submit" style="margin-right: 0px;" class="btn btn-solid w-100 col-xl-4 col-lg-4" id="checkout">ادامه فرایند خرید</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        

<script>
    $("#clear-cart").click(function(event){
        shoppingCart.clearCart();
        displayCart();
    });
    function displayCart() {
        let cartArray = shoppingCart.listCart();
        document.getElementById("numberOfProductInBasket").innerHTML = shoppingCart.countCart();
        // console.log(cartArray);
        var output = "";
        if(cartArray.length === 0){
            document.getElementById("checkout").style.visibility = 'hidden';
        }
        for (var i in cartArray) {
            output +=
            "<div class='col-xl-4 col-md-4 col-sm-12 xl-50' style='margin-top: 25px; margin-bottom: 25px;'>" +
                "<div class='card shadow-lg' style='width: 100%; height: 100%; margin-top: 25px;'>"+
                    "<img src='"+cartArray[i].picture+"' class='card-img-top col-xl-3 col-md-6 col-sm-6' style='width: 100%;' alt='...'>"+
                    "<div class='card-body'>"+
                        "<h5 class='card-title' id='BasketCard'>"+
                        cartArray[i].name +
                        "</h5>"+
                        "<div style='display:flex; justify-content: flex-start ;'>"+
                        "<h5 style='margin-left: 25px;'> قیمت: "+
                        cartArray[i].price +
                        " تومان</h5>"+
                        "<h5> تعداد: "+
                        cartArray[i].count +
                        "</h5>"+
                        "</div>"+
                        "<p> قیمت کل: "+
                        cartArray[i].total+
                        " تومان</p>"+
                        // "<input type='button' onclick='" + deleteFunc(cartArray[i].id)+ "' value='🗑️' style='margin-right: 0px;' class='btn btn-solid'>"+
                    "</div>"+
                "</div>"+
            "</div>"
        }
        function deleteFunc(id){
        shoppingCart.removeItemFromCartAll(id);
        displayCart();
    }
        $("#show-cart").html(output);
        $("#count-cart").html( shoppingCart.countCart() );
        $("#total-cart").html( shoppingCart.totalCart() );
    }
    
    $("#show-cart").on("change", ".item-count", function(event){
        var id = $(this).attr("data-id");
        var count = Number($(this).val());
        shoppingCart.setCountForItem(id, count);
        displayCart();
    });

    displayCart();
</script>

<%- include("footer"); -%>
